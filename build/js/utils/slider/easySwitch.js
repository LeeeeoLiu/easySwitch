define(["jquery","lazyload"],function($,lazyload){var my={},constructorFunName="Eswitch",pluginName="easySwitch";return my[constructorFunName]=function(container,options){var imgEle,self=this;this.container=container;var settings=$.extend({},$.fn[pluginName].defaults,options);for(var props in settings)settings.hasOwnProperty(props)&&(this[props]=settings[props]);imgEle=container.find("."+this.switchItemName+" img").eq(this.startIndex),imgEle.parents("."+this.switchItemName).addClass("prev"),this.width=this.containerWidth||this.container.width()||imgEle.width(),this.height=this.containerHeight||this.container.height()||imgEle.height(),this.itemsLen=this.container.find("."+this.switchItemName).length,this.timer=null,this.isAnimating=!1,this.moveLenConfig={left:self.width,top:self.height},this.moveLen=this.moveLenConfig[this.moveDirection],this.moveAnimateConfig={currentE:{animate:{},css:{}},prevE:{animate:{},css:{}}},this.moveAnimateConfig.currentE.animate[self.moveDirection]=0,this.moveAnimateConfig.prevE.animate[self.moveDirection]=0,this.moveAnimateConfig.currentE.css[self.moveDirection]=0,this.init()},my[constructorFunName].prototype={constructor:my[constructorFunName],init:function(){var self=this;this.setContainerStyle(),this.isPlayNumber&&this.renderPlayNumber(),this.isPlayThumb&&this.renderThumb(),this.isDirbtn&&this.renderDirectionBtn(),this.autoSwitch(),this.isHoverPause&&this.container.on("mouseover",function(){self.stopSwitch()}).on("mouseout",function(){self.autoSwitch()})},setContainerStyle:function(){var self=this;this.container.css({width:self.width,height:self.height})},createSwitchWrapper:function(){return this.isSwitchWrapperCreated?!1:(this.isSwitchWrapperCreated=!0,'<div class="'+this.switchWrapperName+'" style="width:'+this.width+"px;height:"+this.height+'px"></div>')},createThumb:function(){var thumbContainerWidth,thumbContainerHeight,directionClass,$sliderItem,tmp,activeClass,i=0,j=this.itemsLen;for("horizen"===this.thumbDirection?(thumbContainerWidth=(this.thumbWidth+this.thumbGutter)*this.thumbItems-this.thumbGutter,thumbContainerHeight=this.thumbHeight,directionClass="switch-thumb-horizen"):"vertical"===this.thumbDirection&&(thumbContainerWidth=this.thumbWidth,thumbContainerHeight=(this.thumbHeight+this.thumbGutter)*this.thumbItems-this.thumbGutter,directionClass="switch-thumb-vertical"),tmp='<div class="'+this.thumbName+" "+directionClass+'" style="width:'+thumbContainerWidth+"px;height:"+thumbContainerHeight+'px;"><div class="thumb-inner">',$sliderItem=this.container.find("."+this.switchItemName);j>i;i++)activeClass=i===this.startIndex?" current":"",tmp+='<span class="thumb-nav-item'+activeClass+'" style="width:'+this.thumbWidth+"px;height:"+this.thumbHeight+"px;background-image:"+$sliderItem.eq(i).data("thumb")+';"></span>';return tmp+="</div></div>"},createPlayNumber:function(){for(var i=0,j=this.itemsLen,tmp='<div class="'+this.switchNumberName+'">';j>i;i++)tmp+=i===this.startIndex?'<a href="#" class="current">'+(i+1)+"</a>":'<a href="#">'+(i+1)+"</a>";return tmp+="</div>"},renderPlayNumber:function(){var switchWrapper=this.createSwitchWrapper(),self=this;switchWrapper&&this.container.wrap(switchWrapper),this.container.parent().append(self.createPlayNumber()),this.playNumberEvent()},renderThumb:function(){var switchWrapper=this.createSwitchWrapper(),self=this;switchWrapper&&this.container.wrap(switchWrapper),this.container.parent().append(self.createThumb()),this.playThumbEvent()},moveThumb:function(index){var moveUnit,realMove,moveStartIndex,moveMax,$thumbContainer=this.container.parent().find(".thumb-inner"),_this=this;if(this.thumbItems>=this.itemsLen)return void(this.thumbItems=this.itemsLen);if(moveStartIndex=Math.ceil(this.thumbItems/2),moveUnit=Math.floor((this.thumbItems-1)/2),realMove=moveUnit*Math.ceil(index/moveUnit-1),moveMax=this.itemsLen-this.thumbItems,"horizen"===this.thumbDirection){if(moveStartIndex>index)return void $thumbContainer.animate({left:"0"},this.effectDuration);moveMax>realMove?$thumbContainer.animate({left:-realMove*(_this.thumbWidth+_this.thumbGutter)+"px"},this.effectDuration):$thumbContainer.animate({left:-moveMax*(_this.thumbWidth+_this.thumbGutter)+"px"},this.effectDuration)}else if("vertical"===this.thumbDirection){if(moveStartIndex>index)return void $thumbContainer.animate({top:"0"},this.effectDuration);moveMax>realMove?$thumbContainer.animate({top:-realMove*(_this.thumbHeight+_this.thumbGutter)+"px"},this.effectDuration):$thumbContainer.animate({top:-moveMax*(_this.thumbHeight+_this.thumbGutter)+"px"},this.effectDuration)}},playThumbEvent:function(){var self=this;this.container.parent().find("."+this.thumbName).on("click","a",function(e){e.preventDefault(),self.gotoIndex($(this).index(),self.startIndex,""),self.moveThumb($(this).index())})},playNumberEvent:function(){var self=this;this.container.parent().find("."+this.switchNumberName).on("click","a",function(e){e.preventDefault(),self.gotoIndex($(this).index(),self.startIndex,"")})},playThumb:function(index){this.container.parent().find("."+this.thumbName).find("a").eq(index).addClass("current").siblings().removeClass("current"),this.moveThumb(index)},playNumber:function(index){this.container.parent().find("."+this.switchNumberName).find("a").eq(index).addClass("current").siblings().removeClass("current")},gotoIndex:function(index,prevIndex,directionFlag){this.stopSwitch(),this.scroll(index,prevIndex,directionFlag),this.autoSwitch()},createDirectionBtn:function(){return'<a href="#" class="'+this.prevBtnName+'">上一张</a><a href="#" class="'+this.nextBtnName+'">下一张</a>'},renderDirectionBtn:function(){var switchWrapper=this.createSwitchWrapper(),self=this;switchWrapper&&this.container.wrap(switchWrapper),this.container.parent().append(self.createDirectionBtn()),this.prevBtnEvent(),this.nextBtnEvent()},prevBtnEvent:function(){var clickIndex,self=this;this.container.parent().find("."+this.prevBtnName).on("click",function(e){e.preventDefault(),clickIndex=self.getPrev(self.startIndex),self.gotoIndex(clickIndex,self.startIndex,-1)})},nextBtnEvent:function(){var clickIndex,self=this;this.container.parent().find("."+this.nextBtnName).on("click",function(e){e.preventDefault(),clickIndex=self.getNext(self.startIndex),self.gotoIndex(clickIndex,self.startIndex,1)})},getDirection:function(gotoIndex,prevIndex){var res=gotoIndex-prevIndex;return res>=1?1:0>res?-1:0},getPrev:function(index){return 0===index?this.itemsLen-1:index-1},getNext:function(index){return index+1===this.itemsLen?0:index+1},getMoveDistance:function(index,prevIndex,directionFlag){var moveLen=this.moveLen;return""===directionFlag?this.timer?moveLen:this.getDirection(index,prevIndex)*moveLen:directionFlag*moveLen},scroll:function(index,prevIndex,directionFlag){if(index!==prevIndex&&!this.isAnimating){this.isAnimating=!0,this.startIndex=index;var promiseCurrent,promisePrev,self=this,moveDistance=0,container=this.container,currentEle=container.find("."+this.switchItemName).eq(index),prevEle=container.find("."+this.switchItemName).eq(prevIndex);container.find("."+this.switchItemName).removeClass("current prev"),"moveEffect"===this.effect&&(moveDistance=this.getMoveDistance(index,prevIndex,directionFlag),self.moveAnimateConfig.currentE.css[self.moveDirection]=moveDistance+"px",self.moveAnimateConfig.prevE.animate[self.moveDirection]=-moveDistance+"px",promiseCurrent=currentEle.addClass("current").css(self.moveAnimateConfig.currentE.css).stop(!0,!0).animate(self.moveAnimateConfig.currentE.animate,self.effectDuration,"linear",function(){$(this).siblings().removeClass("prev").attr("style",""),$(this).css("z-index","1")}).promise(),promisePrev=prevEle.addClass("prev").stop(!0,!0).animate(self.moveAnimateConfig.prevE.animate,self.effectDuration,"linear",function(){$(this).attr("style","")}).promise()),"fadeEffect"===this.effect&&(promiseCurrent=currentEle.stop(!0,!0).fadeIn(self.effectDuration).promise(),promisePrev=prevEle.stop(!0,!0).fadeOut(self.effectDuration).promise()),self.isPlayThumb&&self.playThumb(index),self.isPlayNumber&&self.playNumber(index),$.when(promiseCurrent,promisePrev).done(function(){self.lazyloadImg(),self.isAnimating=!1})}},autoSwitch:function(){var prevIndex,self=this;this.timer=setInterval(function(){prevIndex=self.startIndex,self.startIndex=self.getNext(self.startIndex),self.scroll(self.startIndex,prevIndex,1)},self.intervalTime)},stopSwitch:function(){var self=this;this.timer&&(clearInterval(self.timer),self.timer=null)},lazyloadImg:function(){this.container.find("img").lazyload()}},$.fn[pluginName]=function(opts){if("string"==typeof opts){if("api"===opts)return $(this).data("plugin-"+pluginName);throw new Error('error string ,here supports "api" only!')}return this.each(function(){var that=$(this),s1=new my[constructorFunName](that,opts);return that.data("plugin-"+pluginName)?void 0:that.data("plugin-"+pluginName,s1)})},$.fn[pluginName].defaults={switchWrapperName:"switch-wrapper",switchItemName:"switch-item",switchNumberName:"switch-number",thumbName:"switch-thumb",prevBtnName:"switch-prev",nextBtnName:"switch-next",effect:"moveEffect",moveDirection:"left",containerWidth:0,containerHeight:0,isHoverPause:!0,isPlayNumber:!0,isPlayThumb:!1,isDirbtn:!0,startIndex:0,intervalTime:3e3,effectDuration:500,thumbWidth:200,thumbHeight:70,thumbGutter:10,thumbItems:2,thumbDirection:"horizen"},constructorFunName});